---
import { getCollection } from 'astro:content';
import Card from '~/components/Card.astro';
import Container from '~/components/Container.astro';
import BaseLayout from '~/layouts/BaseLayout.astro';


export async function getStaticPaths() {
  const allDemos = await getCollection("demos")
  const categories = [...new Set(allDemos.map(demo => demo.data.category.toLowerCase()))]

  return categories.map(category => ({
    params: { 
      category
    },
    props: {
      allDemos
    }
  }))
}

const { category } = Astro.params
const { allDemos } = Astro.props

if (!category) {
  throw new Response("Not found", {status: 404})
}

const demos = allDemos.filter(
  demo => demo.data.category.toLowerCase() === category.toLocaleLowerCase())
  .sort((a, b) => new Date(b.data.date ?? 0).getTime() - new Date(a.data.date ?? 0).getTime())
---
<BaseLayout>
  <Container>
    <h1 class="font-display">{category.toUpperCase()} <span class="italic">Animations</span></h1>
    <p>
      Simple web animation created with {category}.
    </p>

    <section>
        <div class="grid grid-cols-4 gap-4">
          {demos.map(demo => (
            <Card title={demo.data.title} slug={demo.slug} colors={demo.data.colors} />
          ))}
        </div>
    </section>
  </Container>
</BaseLayout>